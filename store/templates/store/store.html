{% extends 'index.html' %}
{% load static %}

{% block content %}
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
  {% for product in products %}
  <div class="group relative bg-white rounded-2xl shadow-md hover:shadow-lg transition p-4 z-10">
    <!-- Product Image -->
    <div class="aspect-w-1 aspect-h-1 w-full overflow-hidden rounded-xl bg-gray-100">
      <img src="{{ product.imageURL }}" alt="{{ product.name }}" class="h-full w-full object-cover object-center group-hover:scale-105 transition-transform duration-300">
    </div>
    <!-- Product Info -->
    <div class="mt-4 flex justify-between items-start">
      <h3 class="text-lg font-medium text-gray-900">{{ product.name }}</h3>
      <p class="text-md font-semibold text-gray-800">SGD {{ product.price|floatformat:2 }}</p>
    </div>
    <!-- Actions -->
    <div class="mt-4 flex items-center gap-2">
      <button data-product="{{ product.id }}" data-action="add" class="update-cart flex-1 rounded-xl border border-gray-300 px-3 py-2 text-sm font-medium text-gray-900 hover:bg-gray-200 transition">
        Add to Cart
      </button>
      <button data-drawer-target="drawer-{{ product.id }}" data-drawer-toggle="drawer-{{ product.id }}" class="flex-1 rounded-xl border border-gray-300 px-3 py-2 text-sm font-medium text-gray-900 hover:bg-gray-200 transition">
        View
      </button>
    </div>
  </div>
  {% endfor %}
</div>
<!-- DRAWERS -->
{% for product in products %}
<div id="drawer-{{ product.id }}" class="fixed inset-0 z-50 hidden">
  <!-- Overlay -->
  <div class="absolute inset-0 bg-black/50" data-drawer-hide="drawer-{{ product.id }}"></div>

  <!-- Drawer Content -->
  <div id="drawer-content-{{ product.id }}" class="fixed top-0 right-0 h-full w-full sm:w-3/4 md:w-1/2 lg:w-1/3 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
    
    <!-- Close Button -->
    <button data-drawer-hide="drawer-{{ product.id }}" class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 text-2xl font-bold">
      âœ•
    </button>

    <!-- Product Detail -->
    <div class="p-6 overflow-y-auto" style="max-height: 100vh;">
      <img src="{{ product.imageURL }}" alt="{{ product.name }}" class="rounded-xl w-full object-cover mb-6">
      <h2 class="text-2xl font-semibold text-gray-900">{{ product.name }}</h2>
      <p class="mt-2 text-gray-800 font-medium text-lg">SGD {{ product.price|floatformat:2 }}</p>
      <p class="mt-4 text-gray-600">{{ product.description|default:"No description available." }}</p>
      <button data-product="{{ product.id }}" data-action="add" class="mt-6 w-full rounded-xl bg-yellow-500 text-white px-4 py-2 text-sm font-medium hover:bg-yellow-600 transition">
        Add to Cart
      </button>
    </div>
  </div>
</div>
{% endfor %}

<script>
  // Open drawer
  document.querySelectorAll("[data-drawer-toggle]").forEach(button => {
    button.addEventListener("click", () => {
      const targetId = button.dataset.drawerTarget;
      const drawer = document.getElementById(targetId);
      const content = drawer.querySelector("#drawer-content-" + targetId.split("-")[1]);
      drawer.classList.remove("hidden");
      requestAnimationFrame(() => content.classList.remove("translate-x-full"));
    });
  });

  // Close drawer
  document.querySelectorAll("[data-drawer-hide]").forEach(button => {
    button.addEventListener("click", () => {
      const targetId = button.dataset.drawerHide;
      const drawer = document.getElementById(targetId);
      const content = drawer.querySelector("#drawer-content-" + targetId.split("-")[1]);
      content.classList.add("translate-x-full");
      setTimeout(() => drawer.classList.add("hidden"), 300);
    });
  });
</script>
{% endblock %}
